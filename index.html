<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مغامرة الجزيرة - لعبة تعاونية بدون إعدادات</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* نفس الأنماط السابقة - محفوظة للمساحة */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root { --player1: #3498db; --player2: #e74c3c; --team: #2ecc71; --dark: #2c3e50; --light: #ecf0f1; --gold: #f1c40f; }
        body { background: linear-gradient(135deg, #1a2980, #26d0ce); color: var(--light); min-height: 100vh; padding: 20px; display: flex; justify-content: center; align-items: center; }
        .container { max-width: 900px; width: 100%; background-color: rgba(44, 62, 80, 0.95); border-radius: 20px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.2); border: 3px solid var(--team); }
        .header { background: linear-gradient(90deg, var(--player1) 0%, var(--player2) 100%); padding: 25px; text-align: center; border-bottom: 3px solid var(--gold); }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .game-area { padding: 30px; min-height: 600px; }
        .login-screen { text-align: center; padding: 40px 20px; }
        .login-title { font-size: 2rem; color: var(--gold); margin-bottom: 30px; }
        .player-select { display: flex; justify-content: center; gap: 30px; margin: 40px 0; }
        .player-option { background-color: rgba(255,255,255,0.1); border-radius: 15px; padding: 30px; width: 250px; cursor: pointer; transition: all 0.3s ease; border: 3px solid transparent; }
        .player-option:hover { transform: translateY(-10px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .player-option.player1:hover { border-color: var(--player1); }
        .player-option.player2:hover { border-color: var(--player2); }
        .player-icon { font-size: 4rem; margin-bottom: 20px; }
        .player-name { font-size: 1.8rem; font-weight: bold; margin-bottom: 10px; }
        .room-code-section { margin: 40px 0; padding: 25px; background-color: rgba(0,0,0,0.2); border-radius: 15px; border: 2px solid var(--gold); }
        .room-code-display { font-size: 2.5rem; font-weight: bold; letter-spacing: 5px; background-color: var(--dark); padding: 15px; border-radius: 10px; margin: 20px 0; border: 2px solid var(--team); }
        .code-input { display: flex; gap: 10px; margin-top: 20px; }
        .code-input input { flex: 1; padding: 15px; font-size: 1.5rem; text-align: center; border-radius: 10px; border: 2px solid var(--team); background-color: var(--dark); color: white; letter-spacing: 3px; }
        .code-input button { padding: 15px 25px; background-color: var(--team); color: white; border: none; border-radius: 10px; font-size: 1.2rem; cursor: pointer; }
        .waiting-message { background-color: rgba(52,152,219,0.2); border-radius: 15px; padding: 20px; margin: 30px 0; border: 2px solid var(--player1); text-align: center; font-size: 1.3rem; }
        .game-screen { display: none; }
        .scene-container { background-color: rgba(0,0,0,0.3); border-radius: 15px; padding: 25px; margin-bottom: 30px; min-height: 250px; border: 2px solid rgba(255,255,255,0.1); }
        .scene-title { font-size: 1.8rem; color: var(--gold); margin-bottom: 20px; }
        .scene-text { font-size: 1.3rem; line-height: 1.8; margin-bottom: 10px; }
        .choices-container { display: grid; grid-template-columns: 1fr; gap: 15px; margin: 25px 0; }
        .choice-btn { background: linear-gradient(135deg, var(--dark) 0%, #34495e 100%); color: white; border: none; padding: 20px; border-radius: 12px; font-size: 1.3rem; cursor: pointer; transition: all 0.3s ease; text-align: right; border: 2px solid transparent; display: flex; align-items: center; gap: 15px; }
        .choice-btn:hover { transform: translateY(-5px); border-color: var(--team); box-shadow: 0 5px 15px rgba(46,204,113,0.4); }
        .team-section { background: linear-gradient(135deg, rgba(46,204,113,0.2), rgba(46,204,113,0.05)); border-radius: 15px; padding: 20px; margin: 20px 0; border: 2px solid var(--team); }
        .team-title { font-size: 1.5rem; color: var(--team); margin-bottom: 15px; text-align: center; }
        .player-choices { display: flex; justify-content: space-between; gap: 15px; margin: 20px 0; }
        .player-choice { flex: 1; text-align: center; padding: 15px; border-radius: 10px; font-weight: bold; font-size: 1.1rem; }
        .player1-choice { background-color: rgba(52,152,219,0.3); border: 2px solid var(--player1); }
        .player2-choice { background-color: rgba(231,76,60,0.3); border: 2px solid var(--player2); }
        .team-actions { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
        .team-btn { padding: 15px 30px; background-color: var(--team); color: white; border: none; border-radius: 10px; font-size: 1.2rem; cursor: pointer; }
        .copy-btn { background-color: var(--gold); color: var(--dark); border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-size: 1rem; margin-top: 10px; }
        @media (max-width: 768px) { .player-select { flex-direction: column; align-items: center; } .player-option { width: 100%; max-width: 300px; } }
    </style>
</head>
<body>
    <div class="container">
        <!-- شاشة الدخول -->
        <div class="game-area" id="loginScreen">
            <div class="login-screen">
                <div class="login-title">
                    <i class="fas fa-users"></i> مغامرة الجزيرة التعاونية
                </div>
                <p style="font-size: 1.3rem; margin-bottom: 30px;">
                    لعبة تعاونية لصديقين - سهل التشغيل بدون إعدادات معقدة!
                </p>
                
                <div class="player-select">
                    <div class="player-option player1" id="player1Btn">
                        <div class="player-icon" style="color: var(--player1);">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="player-name" style="color: var(--player1);">
                            اللاعب 1 (أنت)
                        </div>
                        <div class="player-desc">
                            أنشئ اللعبة وأرسل الرمز لصديقك
                        </div>
                    </div>
                    
                    <div class="player-option player2" id="player2Btn">
                        <div class="player-icon" style="color: var(--player2);">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="player-name" style="color: var(--player2);">
                            اللاعب 2 (صديقك)
                        </div>
                        <div class="player-desc">
                            انضم برمز الدعوة من صديقك
                        </div>
                    </div>
                </div>
                
                <!-- قسم إنشاء الغرفة -->
                <div class="room-code-section" id="createRoomSection" style="display: none;">
                    <div class="room-code-title">
                        <i class="fas fa-plus-circle"></i> أنشئ غرفة جديدة
                    </div>
                    <div class="room-code-display" id="roomCodeDisplay">
                        جاري الإنشاء...
                    </div>
                    <button class="copy-btn" id="copyCodeBtn">
                        <i class="fas fa-copy"></i> انسخ الرمز
                    </button>
                    <div class="waiting-message" id="waitingMessage">
                        <i class="fas fa-hourglass-half"></i> انتظر صديقك يدخل الرمز...
                    </div>
                </div>
                
                <!-- قسم الانضمام للغرفة -->
                <div class="room-code-section" id="joinRoomSection" style="display: none;">
                    <div class="room-code-title">
                        <i class="fas fa-sign-in-alt"></i> انضم إلى غرفة
                    </div>
                    <div class="code-input">
                        <input type="text" id="roomCodeInput" placeholder="أدخل الرمز" maxlength="6">
                        <button id="joinRoomBtn">
                            <i class="fas fa-play"></i> انضم
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- شاشة اللعب -->
        <div class="game-area game-screen" id="gameScreen">
            <div class="scene-container">
                <div class="scene-title">
                    <i class="fas fa-map-marked-alt"></i>
                    <span id="sceneTitle">مدخل الجزيرة الغامضة</span>
                </div>
                <div class="scene-text" id="sceneText">
                    أنت وصديقك على جزيرة غامضة. أمامكم ثلاث طرق. يجب أن تتفقا على طريق واحد.
                </div>
                
                <div class="player-choices">
                    <div class="player-choice player1-choice" id="player1ChoiceDisplay">
                        <i class="fas fa-user"></i> قرارك: ينتظر
                    </div>
                    <div class="player-choice player2-choice" id="player2ChoiceDisplay">
                        <i class="fas fa-user-friends"></i> صديقك: ينتظر
                    </div>
                </div>
            </div>
            
            <div class="choices-container" id="choicesContainer">
                <button class="choice-btn" id="choice1Btn">
                    <i class="fas fa-tree"></i> ندخل إلى الغابة
                </button>
                <button class="choice-btn" id="choice2Btn">
                    <i class="fas fa-mountain"></i> نستكشف الكهف
                </button>
                <button class="choice-btn" id="choice3Btn">
                    <i class="fas fa-umbrella-beach"></i> نبقى على الشاطئ
                </button>
            </div>
            
            <div class="team-section">
                <div class="team-title">
                    <i class="fas fa-handshake"></i> قرار الفريق
                </div>
                <div class="team-actions">
                    <button class="team-btn" id="confirmChoiceBtn" disabled>
                        <i class="fas fa-check-circle"></i> نتفق على هذا القرار
                    </button>
                    <button class="team-btn" id="resetBtn">
                        <i class="fas fa-redo"></i> غير رأيك
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // نظام تخزين محلي بسيط
        class LocalMultiplayer {
            constructor() {
                this.player = null;
                this.roomId = null;
                this.interval = null;
                this.gameState = {
                    player1Choice: null,
                    player2Choice: null,
                    scene: 1,
                    teamPoints: 100,
                    gameOver: false
                };
            }
            
            // إنشاء غرفة
            createRoom() {
                const code = this.generateCode();
                this.player = 'player1';
                this.roomId = code;
                
                // حفظ حالة الغرفة
                localStorage.setItem(`room_${code}`, JSON.stringify({
                    created: Date.now(),
                    player1Connected: true,
                    player2Connected: false,
                    ...this.gameState
                }));
                
                // بدء التحديث الدوري
                this.startSync();
                return code;
            }
            
            // الانضمام لغرفة
            joinRoom(code) {
                const roomData = JSON.parse(localStorage.getItem(`room_${code}`));
                
                if (!roomData) {
                    throw new Error('الغرفة غير موجودة');
                }
                
                if (roomData.player2Connected) {
                    throw new Error('الغرفة ممتلئة');
                }
                
                this.player = 'player2';
                this.roomId = code;
                
                // تحديث حالة الغرفة
                roomData.player2Connected = true;
                localStorage.setItem(`room_${code}`, JSON.stringify(roomData));
                
                // بدء التحديث الدوري
                this.startSync();
                return roomData;
            }
            
            // مزامنة البيانات
            startSync() {
                this.interval = setInterval(() => {
                    this.syncGameState();
                }, 1000); // تحديث كل ثانية
            }
            
            syncGameState() {
                const roomData = JSON.parse(localStorage.getItem(`room_${this.roomId}`));
                if (roomData) {
                    this.gameState = roomData;
                    this.onUpdate && this.onUpdate(roomData);
                }
            }
            
            // تحديث القرار
            updateChoice(choice) {
                const roomData = JSON.parse(localStorage.getItem(`room_${this.roomId}`));
                if (!roomData) return;
                
                if (this.player === 'player1') {
                    roomData.player1Choice = choice;
                } else {
                    roomData.player2Choice = choice;
                }
                
                localStorage.setItem(`room_${this.roomId}`, JSON.stringify(roomData));
            }
            
            // تأكيد القرار الجماعي
            confirmTeamChoice() {
                const roomData = JSON.parse(localStorage.getItem(`room_${this.roomId}`));
                if (!roomData) return;
                
                // الانتقال للمشهد التالي
                roomData.scene++;
                roomData.player1Choice = null;
                roomData.player2Choice = null;
                
                localStorage.setItem(`room_${this.roomId}`, JSON.stringify(roomData));
            }
            
            // إنشاء رمز عشوائي
            generateCode() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let code = '';
                for (let i = 0; i < 6; i++) {
                    code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return code;
            }
            
            // تنظيف
            cleanup() {
                if (this.interval) {
                    clearInterval(this.interval);
                }
            }
        }
        
        // تهيئة اللعبة
        const game = new LocalMultiplayer();
        const scenes = [
            {
                title: "مدخل الجزيرة الغامضة",
                text: "أنت وصديقك وصلتم إلى جزيرة غامضة بعد عاصفة قوية. أمامكم ثلاث طرق. يجب أن تتفقا على طريق واحد تسلكانه معًا.",
                choices: ["ندخل إلى الغابة", "نستكشف الكهف", "نبقى على الشاطئ"]
            },
            {
                title: "عمق الغابة",
                text: "دخلتم إلى الغابة ووجدتم شجرة فاكهة غريبة. الثمار تبدو لذيذة ولكن لونها غريب. ماذا تفعلان؟",
                choices: ["نتناول بعض الثمار", "نتجاهلها ونواصل", "نفحصها بحذر"]
            },
            {
                title: "الكهف المظلم",
                text: "دخلتم إلى كهف مظلم. تسمعان صوت ماء يقطر. تجدان صندوقاً قديماً. ماذا تفعلان؟",
                choices: ["نفتح الصندوق", "نبحث عن مصدر الماء", "نخرج بسرعة"]
            }
        ];
        
        // عناصر DOM
        const loginScreen = document.getElementById('loginScreen');
        const gameScreen = document.getElementById('gameScreen');
        const player1Btn = document.getElementById('player1Btn');
        const player2Btn = document.getElementById('player2Btn');
        const createRoomSection = document.getElementById('createRoomSection');
        const joinRoomSection = document.getElementById('joinRoomSection');
        const roomCodeDisplay = document.getElementById('roomCodeDisplay');
        const copyCodeBtn = document.getElementById('copyCodeBtn');
        const waitingMessage = document.getElementById('waitingMessage');
        const roomCodeInput = document.getElementById('roomCodeInput');
        const joinRoomBtn = document.getElementById('joinRoomBtn');
        const sceneTitle = document.getElementById('sceneTitle');
        const sceneText = document.getElementById('sceneText');
        const choice1Btn = document.getElementById('choice1Btn');
        const choice2Btn = document.getElementById('choice2Btn');
        const choice3Btn = document.getElementById('choice3Btn');
        const player1ChoiceDisplay = document.getElementById('player1ChoiceDisplay');
        const player2ChoiceDisplay = document.getElementById('player2ChoiceDisplay');
        const confirmChoiceBtn = document.getElementById('confirmChoiceBtn');
        const resetBtn = document.getElementById('resetBtn');
        
        // الأحداث
        player1Btn.addEventListener('click', () => {
            player1Btn.style.opacity = '1';
            player2Btn.style.opacity = '0.5';
            createRoomSection.style.display = 'block';
            joinRoomSection.style.display = 'none';
            
            const code = game.createRoom();
            roomCodeDisplay.textContent = code;
            waitingMessage.innerHTML = `<i class="fas fa-hourglass-half"></i> انتظر صديقك يدخل الرمز:<br><strong>${code}</strong>`;
        });
        
        player2Btn.addEventListener('click', () => {
            player1Btn.style.opacity = '0.5';
            player2Btn.style.opacity = '1';
            createRoomSection.style.display = 'none';
            joinRoomSection.style.display = 'block';
        });
        
        copyCodeBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(roomCodeDisplay.textContent);
            alert('تم نسخ الرمز: ' + roomCodeDisplay.textContent);
        });
        
        joinRoomBtn.addEventListener('click', () => {
            const code = roomCodeInput.value.toUpperCase();
            if (code.length !== 6) {
                alert('الرجاء إدخال رمز مكون من 6 أحرف');
                return;
            }
            
            try {
                game.joinRoom(code);
                loginScreen.style.display = 'none';
                gameScreen.style.display = 'block';
                updateScene(0);
            } catch (error) {
                alert(error.message);
            }
        });
        
        // تحديث المشهد
        function updateScene(index) {
            if (index >= scenes.length) {
                sceneTitle.textContent = "نهاية المغامرة!";
                sceneText.textContent = "مبروك! أكملتما المغامرة بنجاح!";
                choicesContainer.style.display = 'none';
                return;
            }
            
            const scene = scenes[index];
            sceneTitle.textContent = scene.title;
            sceneText.textContent = scene.text;
            
            choice1Btn.textContent = scene.choices[0];
            choice2Btn.textContent = scene.choices[1];
            choice3Btn.textContent = scene.choices[2];
            
            choice1Btn.onclick = () => makeChoice(0);
            choice2Btn.onclick = () => makeChoice(1);
            choice3Btn.onclick = () => makeChoice(2);
        }
        
        // اتخاذ قرار
        function makeChoice(index) {
            const choiceText = scenes[game.gameState.scene - 1].choices[index];
            
            if (game.player === 'player1') {
                player1ChoiceDisplay.innerHTML = `<i class="fas fa-user"></i> قرارك: ${choiceText}`;
            } else {
                player2ChoiceDisplay.innerHTML = `<i class="fas fa-user-friends"></i> قرارك: ${choiceText}`;
            }
            
            game.updateChoice(index);
        }
        
        // تأكيد القرار الجماعي
        confirmChoiceBtn.addEventListener('click', () => {
            if (game.gameState.player1Choice !== null && game.gameState.player2Choice !== null) {
                game.confirmTeamChoice();
                updateScene(game.gameState.scene - 1);
                resetChoices();
            }
        });
        
        // إعادة تعيين الخيارات
        resetBtn.addEventListener('click', () => {
            game.updateChoice(null);
            if (game.player === 'player1') {
                player1ChoiceDisplay.innerHTML = `<i class="fas fa-user"></i> قرارك: ينتظر`;
            } else {
                player2ChoiceDisplay.innerHTML = `<i class="fas fa-user-friends"></i> قرارك: ينتظر`;
            }
        });
        
        // تحديث واجهة اللعبة عند تغيير البيانات
        game.onUpdate = (state) => {
            // تحديث خيارات اللاعبين
            if (state.player1Choice !== null) {
                const choiceText = scenes[state.scene - 1].choices[state.player1Choice];
                player1ChoiceDisplay.innerHTML = `<i class="fas fa-user"></i> اللاعب 1: ${choiceText}`;
            }
            
            if (state.player2Choice !== null) {
                const choiceText = scenes[state.scene - 1].choices[state.player2Choice];
                player2ChoiceDisplay.innerHTML = `<i class="fas fa-user-friends"></i> اللاعب 2: ${choiceText}`;
            }
            
            // تفعيل زر التأكيد إذا اتخذ كلا اللاعبين قرارًا
            if (state.player1Choice !== null && state.player2Choice !== null) {
                confirmChoiceBtn.disabled = false;
            } else {
                confirmChoiceBtn.disabled = true;
            }
            
            // تحديث المشهد إذا تغير
            if (state.scene !== game.gameState.scene) {
                updateScene(state.scene - 1);
            }
        };
        
        // تنظيف عند إغلاق الصفحة
        window.addEventListener('beforeunload', () => {
            game.cleanup();
        });
        
        // إذا كان اللاعب 1 ينتظر الاتصال
        if (game.player === 'player1') {
            setTimeout(() => {
                const roomData = JSON.parse(localStorage.getItem(`room_${game.roomId}`));
                if (roomData && roomData.player2Connected) {
                    loginScreen.style.display = 'none';
                    gameScreen.style.display = 'block';
                    updateScene(0);
                }
            }, 1000);
        }
    </script>
</body>
                        </html>
